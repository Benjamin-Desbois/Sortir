{% extends 'base.html.twig' %}

{% block title %}Creation de sortie !{% endblock %}

{% block contenu %}

    {{ form_start(formSortie) }}
    <p>{{ form_row(formSortie.nom, {label: "Nom de la sortie :"}) }}</p>
    <p>{{ form_row(formSortie.datedebut, {label: "Date et heure de la sortie :"}) }}</p>
    <p>{{ form_row(formSortie.datecloture, {label: "Date limite d'inscription :"}) }}</p>
    <p>{{ form_row(formSortie.nbinscriptionsmax, {label: 'Nombre de places :'}) }}</p>
    <p>{{ form_row(formSortie.duree, {label: "Dur√©e :"}) }} minutes</p>
    <p>{{ form_row(formSortie.descriptioninfos, {label: 'Description et infos :'}) }}</p>
    <p><label>Ville organisatrice :</label>{{ orga.sitesnosite.nom }}</p>
    <div><label>Ville :</label>
        <select id="villes">
            {% for ville in villes %}
            <option value="{{ ville.id }}">{{ ville.nomville }}</option>
            {% endfor %}
        </select></div>
    <p>{{ form_row(formSortie.lieux_no_lieu, {label: "Lieu : "}) }}</p>
    <div><label>LieuJson :</label>
        <select id="lieux"></select>
    </div>
    <p><label>Rue :</label></p>
    <p id="codePostal"><label>Code Postal :</label></p>
    <p><label>Latitude :</label>TODO</p>
    <p><label>Longitude :</label>TODO</p>
    <input type="submit" value="Enregistrer">
    <input type="submit" value="Publiez la sortie">
    <input type="submit" value="Annuler">
    {{ form_end(formSortie) }}

{% endblock %}

{% block javascripts %}
<script>
    $(document).ready(function(){
        $("#villes").change(function(){
            let id = $(this).val();
            let lieux = document.getElementById("lieux");

            fetch("/getLieuxByVille/"+id)
                .then(reponse => reponse.json())
                .then(data => {
                    lieux.innerHTML = "";
                    for (let lieu of data){
                        lieux.innerHTML += "<option value='"+lieu.id+"'>"+lieu.nom_lieu+"</option>";
                    }
                    document.getElementById("codePostal").innerText = "Code Postal : 00000";
                })
                .catch(erreur => console.log(erreur));
        });
    });
</script>
{% endblock %}